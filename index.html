<!DOCTYPE html>
<html>
    <head>

    </head>
    <body>
        <div id="App"></div>
        <script type="module">
            import { html, render } from 'https://unpkg.com/lit-html/lit-html.js';
            
            var Model;
            var Methods;
            var Render;

            Methods = {
                Reset:(inTier)=>
                {
                    inTier.Open = Model.People.slice();
                    inTier.Closed = [];
                    Render.Update(Model, Methods);
                },
                Add:(inTier, inIndex)=>
                {
                    inTier.Closed.push(inTier.Open.splice(inIndex, 1));
                    Render.Update(Model, Methods);
                },
                Remove:(inTier, inIndex)=>
                {
                    var i;
                    var name;

                    name = inTier.Closed.splice(inIndex, 1);
                    for(i=0; i<inTier.Open.length; i++)
                    {
                        console.log("checking", name, "against", inTier.Open[i]);
                        if(name < inTier.Open[i])
                        {
                            inTier.Open.splice(i, 0, name);
                            break;
                        }
                    }
                    Render.Update(Model, Methods);
                },
                Submit:()=>
                {

                }
            };

            Model = {
                People:[
                    ":( no one",
                    "Adam", "Alistair", "Amy",
                    "Barbara", "Bob",
                    "Caleb", "Carolyn",
                    "Donna",
                    "Ed", "Emily",
                    "Jake", "Jeannie",
                    "Jennifer", "Jenny", "John", "Jon",
                    "Kallen", "Karol",
                    "Leah",
                    "Matt", "Mike",
                    "Nancy",
                    "Rebekah",
                    "Sarah P", "Sarah S", "Stacey"
                ],
                Tiers:[
                    {Name:"Round 2",  Open:[], Closed:[]},
                    {Name:"Sweet 16", Open:[], Closed:[]},
                    {Name:"Elite 8",  Open:[], Closed:[]},
                    {Name:"Final 4",  Open:[], Closed:[]}
                ]
            };

            Render = {};
            Render.Update = (inModel, inMethods) =>
            {
                render( Render.Layout(inModel, inMethods), document.querySelector("#App"));
            };
            Render.Layout = (inModel, inMethods) =>
            {
                return html`
                <div>
                    <h2>Tiers</h2>
                    ${inModel.Tiers.map( (inItem)=>{
                        return Render.Tier(inItem, inMethods);
                    } )}
                </div>
                `;
            },
            Render.Tier = (inTier, inMethods) =>
            {
                return html`
                <div>
                    <h3>${inTier.Name}</h3>
                    <ol>
                    ${inTier.Closed.map( (inItem, inIndex)=>{
                        return html`
                        <li><span>${inItem}</span> <button @click=${ ()=>{inMethods.Remove(inTier, inIndex);} }>X</button></li>
                        `;
                    } )}
                    </ol>
                    <select @change=${ (inEvent)=>{ inMethods.Add(inTier, inEvent.target.selectedIndex-1); inEvent.target.selectedIndex=0;} }>
                        <option>choose a #${inTier.Closed.length+1} slot</option>
                    ${inTier.Open.map( (inItem, inIndex)=>{
                        return html`
                        <option>${inItem}</option>
                        `;
                    } )}
                    </select>
                </div>
                `;
            };

            var i;
            for(i=0; i<Model.Tiers.length; i++)
            {
                Methods.Reset(Model.Tiers[i]);
            }
            console.log(Model);
        </script>
    </body>
</html>